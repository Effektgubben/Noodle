<!DOCTYPE html>
<html>
    <head>

        <meta charset="utf-8">
        <link rel="stylesheet" href="Assets/reset.css">
        <link rel="stylesheet" href="Assets/style.css">
        <link rel="stylesheet" href="Assets/nodeTransform.css">
        <link rel="stylesheet" href="Assets/ports.css">
        <link rel="stylesheet" href="Assets/menus.css">
        <link rel="stylesheet" href="Assets/input.css">



        <!-- import external stuff -->
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.0/jquery.min.js"></script>

        <link href='https://fonts.googleapis.com/css?family=Poiret+One' rel='stylesheet' type='text/css'>
        <link href='https://fonts.googleapis.com/css?family=Raleway:300' rel='stylesheet' type='text/css'>

        <!-- Local scripts -->
        <script src="Scripts/noodle.js"></script>

        <script src="Scripts/htmlElements.js"></script>

        <script src="Scripts/input.js"></script>

        <script src="Scripts/events.js"></script>
        <script src="Scripts/active.js"></script>

        <script src="Scripts/coodle.js"></script>

    </head>

    <body>
        <div class="mainContainer" id="mainCont0">
            <svg id="wireBoard0" width="100%"></svg>
            <div id="nodeCanvas"></div>

            <a class="hoverSelect">Slack: </a><input type="number" value="5" onchange="updateWireStyle()" id="slack" class="hoverSelect">
            <a class="hoverSelect">Handle length: </a><input type="number" value="0.5" onchange="updateWireStyle()" id="hanLen" class="hoverSelect">

            <div class="dataBox textDb" id="db0"><input type="text" class="textDbInput"> </div>

        </div>


        <script>
            //{
            var mainCont = document.getElementById("mainCont0");
            var nodeBoard = document.getElementById("nodeCanvas");
            var wireBoard = document.getElementById("wireBoard0"); //TODO: wireBoard should be auto generated


            //nodeCanv(document.getElementById("nodeCanvas"));


            var obj = {
                a: 3, b: [1, [1, 2, "apa"], { p: 1, q: 'a' }], c: { x: 1, y: [7, 5], z: "apa" }
            };
            obj.d = obj;
            obj.b[2].r = obj;

            var flat = noodle.misc.obj.flatList(noodle, obj);
            
            var clone = noodle.misc.obj.clone(noodle, obj);
            
            var obj1 = {a: 3};
            obj1.b = obj1;
            
            var clone1 = noodle.misc.obj.clone(noodle, obj1);



            var coreList = [

                {
                    name: "Add",
                    color: "yellow",
                    inPorts: [
                        noodle.port.newExpr(noodle, 'term0', 'num', true),
                        noodle.port.newExpr(noodle, 'term1', 'num', true)
                    ],
                    inVals: [0, 0],
                    outPorts: [
                        noodle.port.newExpr(noodle, 'sum', 'num', false)
                    ],
                    outVals: [0],
                    func(node){
                        node.core.outPorts[0].value = node.core.inPorts[0].value + node.core.inPorts[0].value;
                    },
                    resetFuncs: []
                },

                {
                    name: "Value",
                    color: "blue",
                    inPorts: [],
                    outPorts: [
                        noodle.port.newExpr(noodle, 'value', 'num', false)
                    ],
                    outVals: [3],
                    func(node){
                        node.core.outPorts[0].value = 3;
                    },
                    resetFuncs: [],
                    htmlContent: noodle.misc.files.getFile('Html/valueNode.html')
                },

                {
                    name: "Text",
                    color: "Grey",
                    inPorts: [],
                    outPorts: [
                        noodle.port.newExpr(noodle, 'value', 'text', false)
                    ],
                    func(node){
                        var core = node.core;
                        //core.data.text = core.inPorts[0].value;
                        core.outPorts[0].value = core.data.text;
                    },
                    data: {
                        text: "",
                        updateOutPort(core){
                            core.outPorts[0].value = core.data.text;
                        }
                    },
                    resetFuncs: [function(){
                        $('.textDbInput').change(defTextDbInputChange); 
                    }],
                    htmlContent: '<input type="text" class="textDbInput">'
                },

                {
                    name: "Eval",
                    color: "Green",
                    inPorts: [
                        noodle.port.newExpr(noodle, 'code', 'text', true)
                    ],
                    outPorts: [],
                    func(node){
                        var core = node.core;
                        eval(core.inPorts[0].value);
                    },
                    data: {
                        code: '',
                    },
                    resetFuncs: [],
                    htmlContent: ''
                },

                {
                    name: "BrowserCode",
                    color: "Grey",
                    inPorts: [],
                    outPorts: [
                        noodle.port.newExpr(noodle, 'function', 'js', false)
                    ],
                    func(node){
                        var core = node.core;

                    },
                    data: {
                        code: null,
                    },
                    resetFuncs: [
                        function(node){
                            noodle.misc.html.firstByClass(node.html, 'btn').onclick = function(){
                                var nodeEl = noodle.misc.html.getParentNodeEl(this);
                                var node = noodle.node.getObj(nodeEl);

                                node.core.data.code = noodle.userFunc;
                            }
                        }
                    ],
                    htmlContent: '<button class="btn">Get code</button>'
                },



                {
                    name: "Dummy",
                    color: "White",
                    inPorts: [
                        noodle.port.newExpr(noodle, 'in', 'text', true)
                    ],
                    outPorts: [
                        noodle.port.newExpr(noodle, 'out', 'text', false)
                    ],
                    func(node){
                        var core = node.core;
                        if(core.inPorts[core.inPorts.length-1].wires.length != 0){ //If last port is connected
                            noodle.port.addToPorts(node, core.inPorts, noodle.port.new(noodle, 'in', 'text', true));
                        }
                        if(core.outPorts[core.outPorts.length-1].wires.length != 0){
                            noodle.port.addToPorts(node, core.outPorts, noodle.port.new(noodle, 'out', 'text', false));
                        }

                    },
                    data: {
                        code: '',
                    },
                    resetFuncs: [function(node){
                        node.core.func(node);
                    }],
                    htmlContent: '<input type="text" class="textDbInput" style="width: 100%">'
                }
            ];
            var coreObj = noodle.misc.arrays.listToObj(coreList);

            var startTime = 0;
            var calcTime = 0;
            startTime = new Date().getTime();
            var forest = [
                //noodle.node.add(noodle, coreObj.Value, '', {x: 0, y: 0}),
                noodle.node.add(noodle, coreObj.Add, '', {x: 500, y: 0}),
                noodle.node.add(noodle, coreObj.Text, '', {x: 40, y: 200}),
                noodle.node.add(noodle, coreObj.Eval, '', {x: 100, y: 500})
            ];
            calcTime = new Date().getTime() - startTime;
            console.log('Render time: ' + calcTime);

            var wires = [];

            noodle.port.connect(forest[0].core.outPorts[0], forest[1].core.inPorts[0]);


            /*
            forest[0].core.outPorts = [{wires: [wires[0]], value: 3}];

            forest[1].core.inPorts = [{name: "Term", wires: [wires[0]], value: 0}, {name: "Term", wires: [], value: 1}];
            forest[1].core.outPorts = [{name: "Sum", wires: [], value: 0}];


            wires[0].node0 = forest[0];
            wires[0].port0 = forest[0].core.outPorts[0];
            wires[0].node1 = forest[1];
            wires[0].port1 = forest[1].core.inPorts[0];


            setNodeHtml(forest[0]);
            renderNode(forest[0], nodeBoard);

            setNodeHtml(forest[1]);
            renderNode(forest[1], nodeBoard);




            add2IdForest(forest[0]);
            add2IdForest(forest[1]);



            renderWire(wires[0]);
            */


            function updateWireStyle(){
                noodle.wire.slack = document.getElementById("slack").value;
                noodle.wire.hanLen = document.getElementById("hanLen").value;
                noodle.wire.update(wires[0]);
            }
            
            //}
        </script>


    </body>

</html>